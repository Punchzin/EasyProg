import { Box, Text } from "ink";
import React, { useEffect, useMemo } from "react";
import { useExitDelay } from "../hooks/useExitDelay";
import hasYarn from "has-yarn";
import { Result as UpdateResult } from "update-check";

export interface Props {
  updateResult: UpdateResult;
}

export const UpgradePackage: React.FC<Props> = ({ updateResult }) => {
  const exit = useExitDelay();
  useEffect(() => {
    exit();
  }, []);

  const installCmd = useMemo(
    () => (hasYarn(".") ? "yarn add" : "npm i --save"),
    [],
  );

  return (
    <Box
      borderStyle="round"
      borderColor="green"
      paddingX={1}
      flexDirection="column"
    >
      <Text color="green">Version {updateResult.latest} is available!</Text>

      <Text>
        Run <Text color="blue">{installCmd} railway@latest</Text> to update
      </Text>
    </Box>
  );
};
