import { Box, Text } from "ink";
import React from "react";
import { getUser } from "../api";
import { useAsyncAction } from "../hooks/useAsyncAction";
import { useExitDelay } from "../hooks/useExitDelay";
import { Spinner } from "./Spinner";

export const List: React.FC = () => {
  const exit = useExitDelay();

  const projectNames = useAsyncAction<string[]>(
    async () => {
      const user = await getUser();
      return (user.projects ?? []).map(p => p.name).filter(Boolean) as string[];
    },
    exit,
    [],
  );

  return (
    <Box>
      {projectNames.loading ? (
        <Box>
          <Spinner />
        </Box>
      ) : projectNames.error != null ? (
        <Text>
          Not logged in. Run <Text color="blue">railway login</Text> to login
        </Text>
      ) : (
        <Box flexDirection="column">
          <Text>✨ Your Projects ✨</Text>

          <Box flexDirection="column" borderStyle="single" paddingX={1}>
            {projectNames.data.map(name => (
              <Text key={name}>{name}</Text>
            ))}
          </Box>
        </Box>
      )}
    </Box>
  );
};
