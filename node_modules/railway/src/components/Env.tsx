import { Box, Text } from "ink";
import React from "react";
import { getEnvs } from "../env";
import { useAsyncAction } from "../hooks/useAsyncAction";
import { useExitDelay } from "../hooks/useExitDelay";
import { Envs } from "../types";
import { Spinner } from "./Spinner";

export const Env: React.FC = () => {
  const exit = useExitDelay();

  const envs = useAsyncAction<Envs>(
    async () => {
      const envs = await getEnvs();
      return envs;
    },
    exit,
    [],
  );

  return (
    <Box>
      {envs.loading ? (
        <Box>
          <Spinner />
        </Box>
      ) : envs.error != null ? (
        <Text color="red">{envs.error}</Text>
      ) : (
        <Box flexDirection="column">
          {Object.entries(envs.data).length === 0 ? (
            <Text>No env for this project</Text>
          ) : (
            Object.entries(envs.data).map(([name, value]) => (
              <Box key={name}>
                <Box minWidth={15}>
                  <Text>{name}</Text>
                </Box>
                <Text>{value}</Text>
              </Box>
            ))
          )}
        </Box>
      )}
    </Box>
  );
};
